# GraphRecall Development Rules

## Git Workflow (CRITICAL)
1. **NEVER** commit directly to main
2. **ONE FEATURE = ONE BRANCH**
   - Branch naming: `feature/phase-X-description` (e.g., `feature/phase-1-ingestion`)
   - Commit message format: `feat: description`, `fix: description`, `refactor: description`
3. **COMMIT AFTER EVERY MAJOR COMPONENT**
   - If you finish the Neo4j schema → Commit
   - If you finish one Agent → Commit with message including agent name
   - If tests pass → Commit
4. **PHASE GATES**: Do not start Phase X+1 until Phase X is committed and working

## Architecture Rules
1. **LangGraph First**: All business logic goes through the graph. No shortcuts around it.
2. **Model Tiering**: Check the Model Selection Strategy table before choosing an LLM. Use the cheapest that works.
3. **Database Separation**:
   - Neo4j = Graph structure only
   - PostgreSQL = Content and user state only
   - Never store blobs in Neo4j, never store relationships in PG
4. **Type Safety**: All LangGraph state must use TypedDict with explicit types

## Code Quality
1. **No Mock Data in Production Code**: If testing, use fixtures in `/tests`
2. **Error Handling**: Every Agent node must have error handling that routes to `error_node` in the graph
3. **Logging**: Use structured logging (JSON) for all agent decisions
4. **Comments**: Complex graph edges must have comments explaining the condition logic

## UI Development Rules
1. **Collaborative Design**: Before implementing any page, ask the user:
   - "What style do you prefer for [component]? Here are 3 options: [describe]"
   - Wait for explicit choice before coding CSS
2. **Responsive**: Mobile-first for study interface (flashcards on phone)
3. **Performance**: Graph visualization must handle 1000+ nodes (use React Flow clustering)

## Testing Requirements
1. **Unit Tests**: Each Agent must have 3 test cases (happy path, edge case, error case)
2. **Integration Tests**: Full graph flow test for ingestion → quiz generation
3. **Never Skip Tests**: If time is short, reduce feature scope but don't skip tests for written code

## Documentation
1. **Agent Prompts**: Keep prompts in separate `.txt` files in `/prompts` folder, not inline in Python
2. **API Changes**: Update this SPEC.md if endpoints change
3. **Comments for Complex Logic**: Explain WHY, not WHAT

## Package Management
1. **Use uv**: All package operations via `uv add`, `uv sync`, `uv run`
2. **Lock File**: Always commit `uv.lock` for reproducible builds
3. **Dev Dependencies**: Add test/dev packages with `uv add --dev`
